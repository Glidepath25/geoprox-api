
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>GeoProx - Unidentified Reports</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="/static/css/geoprox-theme.css">
</head>
<body>
  <div class="gp-app">
    <header class="gp-header">
      <div class="gp-header-title">
        <img src="/static/geoprox-logo.png" alt="GeoProx logo" style="height:32px">
        <span>Unidentified location reports</span>
      </div>
      <nav class="gp-nav">
        <a class="gp-btn gp-btn-outline" href="/dashboard">Dashboard</a>
        <a class="gp-btn gp-btn-outline" href="/admin/users">Manage users</a>
        <form method="post" action="/logout">
          <button class="gp-btn gp-btn-outline" type="submit">Sign out</button>
        </form>
      </nav>
    </header>

    <main class="gp-main">
      <section class="gp-section">
        <h1>Verification queue</h1>
        <div class="gp-muted gp-small">Admins can verify unidentified locations so they appear in desktop searches.</div>
        <div class="gp-stats" style="margin-top:1.2rem">
          <div class="gp-stat">
            <div class="gp-stat-title">Total reports</div>
            <div class="gp-stat-value">{{ record_count }}</div>
          </div>
          <div class="gp-stat">
            <div class="gp-stat-title">Verified</div>
            <div class="gp-stat-value">{{ verified_count }}</div>
            <div class="gp-muted gp-small">{{ verified_count }} of {{ record_count }}</div>
          </div>
          <div class="gp-stat">
            <div class="gp-stat-title">Viewing scope</div>
            <div class="gp-muted gp-small">
              {% if is_global_admin %}
                All organisations
              {% else %}
                {{ company_label or 'Company users only' }}
              {% endif %}
            </div>
          </div>
        </div>
      </section>

      {% if flashes %}
      <section class="gp-section">
        <div class="gp-grid">
          {% for flash in flashes %}
            {% set category = flash.category or 'info' %}
            <div class="gp-flash {{ 'success' if category == 'success' else 'error' if category == 'error' else 'info' }}">{{ flash.message }}</div>
          {% endfor %}
        </div>
      </section>
      {% endif %}

      <section class="gp-section headerless">
        {% if records %}
        <table class="gp-table">
          <thead>
            <tr>
              <th>Recorded</th>
              <th>Category</th>
              <th>Name</th>
              <th>Coordinates</th>
              <th>Address</th>
              <th>Notes</th>
              <th>Submitted by</th>
              <th>Status</th>
              <th>Action</th>
            </tr>
          </thead>
          <tbody>
            {% for item in records %}
            <tr>
              <td>{{ item.created_at_display }}</td>
              <td>{{ item.category_label }}</td>
              <td>{{ item.name }}</td>
              <td>{% if item.latitude_display and item.longitude_display %}{{ item.latitude_display }}, {{ item.longitude_display }}{% else %}&mdash;{% endif %}</td>
              <td>{% if item.address %}{{ item.address }}{% else %}&mdash;{% endif %}</td>
              <td>{% if item.notes %}{{ item.notes }}{% else %}&mdash;{% endif %}</td>
              <td>
                {{ item.submitted_display }}
                {% if item.submitted_company %}<br><span class="gp-muted gp-small">{{ item.submitted_company }}</span>{% endif %}
              </td>
              <td>
                {% if item.is_verified %}
                  <span class="gp-chip status-low">Verified</span>
                  {% if item.verified_at_display or item.verified_by %}
                  <div class="gp-muted gp-small" style="margin-top:0.4rem">
                    {% if item.verified_at_display %}{{ item.verified_at_display }}{% endif %}
                    {% if item.verified_by %}{% if item.verified_at_display %}<br>{% endif %}by {{ item.verified_by }}{% endif %}
                  </div>
                  {% endif %}
                  {% if item.search_category_label %}
                  <div class="gp-muted gp-small">Category: {{ item.search_category_label }}</div>
                  {% endif %}
                {% else %}
                  <span class="gp-chip status-medium">Pending</span>
                  {% if item.suggested_label %}
                  <div class="gp-muted gp-small" style="margin-top:0.4rem">Suggested: {{ item.suggested_label }}</div>
                  {% endif %}
                {% endif %}
              </td>
              <td>
                <form method="post" action="/admin/reports/unidentified/{{ item.id }}/verify" class="gp-inline-form">
                  <select name="search_category">
                    {% for value, label in search_category_options %}
                      <option value="{{ value }}" {% if value == item.current_category_choice %}selected{% endif %}>{{ label }}</option>
                    {% endfor %}
                  </select>
                  <button class="gp-btn" type="submit" {% if not item.has_coordinates %}disabled{% endif %}>
                    {% if item.is_verified %}Update{% else %}Verify &amp; add{% endif %}
                  </button>
                </form>
                {% if not item.has_coordinates %}
                <div class="gp-muted gp-small" style="margin-top:0.25rem">Add latitude and longitude before verifying.</div>
                {% endif %}
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
        {% else %}
        <div class="gp-muted">No unidentified location reports have been submitted yet.</div>
        {% endif %}
      </section>
    </main>

    <footer class="gp-footer">
      Data verified here feeds the desktop search experience.
    </footer>
  </div>
</body>
</html>
